<!DOCTYPE html>
<html>
<head>
    <title>Products</title>
    <style>
        body { font-family: Arial; background:#f4f6f7; padding:20px; }
        h2 { color:#2c3e50; }
        table { width:100%; border-collapse:collapse; margin-top:20px; }
        th, td { border:1px solid #ccc; padding:10px; text-align:left; }
        th { background:#2c3e50; color:white; }
        tr:hover { background:#f1f1f1; }
        a.button, button { padding:5px 10px; background:#2980b9; color:white; text-decoration:none; border:none; border-radius:5px; cursor:pointer; }
        a.button:hover, button:hover { background:#1a5276; }
        .form-container { margin:15px 0; display:none; }
        .form-container input { padding:5px; margin-right:10px; }
    </style>
    <script>
        function toggleForm() {
            var formDiv = document.getElementById("addForm");
            formDiv.style.display = formDiv.style.display === "none" ? "block" : "none";
        }
    </script>
</head>
<body>
    <h2>All Products</h2>

    {% if current_user.Role == "Seller" %}
        <p>
            <button onclick="toggleForm()">âž• Add New Product</button>
        </p>

        <!-- Hidden Add Form -->
        <div id="addForm" class="form-container">
            <form method="POST" action="{{ url_for('products.add_product') }}">
                <input type="text" name="name" placeholder="Product Name" required>
                <input type="number" step="0.01" name="price" placeholder="Price" required>
                <input type="number" name="stock" placeholder="Stock" required>
                <button type="submit">Save</button>
            </form>
        </div>
    {% endif %}

    <table>
        <tr>
            <th>Name</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Action</th>
        </tr>
        {% for product in products %}
        <tr>
            {% if update_id == product.ProductID %}
                <!-- Inline edit form -->
                <form method="POST" action="{{ url_for('products.update_product', product_id=product.ProductID) }}">
                    <td><input type="text" name="name" value="{{ product.Name }}" required></td>
                    <td><input type="number" step="0.01" name="price" value="{{ product.Price }}" required></td>
                    <td><input type="number" name="stock" value="{{ product.Stock }}" required></td>
                    <td>
                        <button type="submit">Update</button>
                        <a class="button" href="{{ url_for('products.my_products') }}">Cancel</a>
                    </td>
                </form>
            {% else %}
                <td>{{ product.Name }}</td>
                <td>{{ product.Price }}</td>
                <td>{{ product.Stock }}</td>
                <td>
                    {% if current_user.Role == "Customer" %}
                        {% if product.Stock > 0 %}
                            <a class="button" href="{{ url_for('orders.buy_product', product_id=product.ProductID) }}">Buy</a>
                        {% else %}
                            Out of Stock
                        {% endif %}
                    {% elif current_user.Role == "Seller" and product.SellerID == current_user.UserID %}
                        <a class="button" href="{{ url_for('products.my_products', edit_id=product.ProductID) }}">Update</a>
                        <a class="button" href="{{ url_for('products.delete_product', product_id=product.ProductID) }}">Delete</a>
                    {% endif %}
                </td>
            {% endif %}
        </tr>
        {% endfor %}
    </table>

    <p><a href="{{ url_for('users.dashboard') }}">Back to Dashboard</a></p>
</body>
</html>
